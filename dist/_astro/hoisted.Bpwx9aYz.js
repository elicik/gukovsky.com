import{S as De}from"./sweetalert2.Cs7ISwYJ.js";import{E as h,c as Re,w as k,d as D,p as z,i as Te,L as Z,D as I,f as b,R as oe,I as Pe,g as Ve,V as de,h as Ke,e as V,C as $e,A as Ne,G as He,T as Q,S as K}from"./index.DSBjsumH.js";import"./hoisted.N2XxB48v.js";import"./_commonjsHelpers.Cpj98o6Y.js";class Xe{constructor(e,s=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=s}add(e){e.forEach(s=>{this._assetList.push(s)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],s=Math.min(this._assetList.length,this._maxConcurrent);for(let a=0;a<s;a++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const ze={extension:h.CacheParser,test:t=>Array.isArray(t)&&t.every(e=>e instanceof Re),getCacheableAssets:(t,e)=>{const s={};return t.forEach(a=>{e.forEach((o,r)=>{s[a+(r===0?"":r+1)]=o})}),s}};async function Se(t){if("Image"in globalThis)return new Promise(e=>{const s=new Image;s.onload=()=>{e(!0)},s.onerror=()=>{e(!1)},s.src=t});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Ye={extension:{type:h.DetectionParser,priority:1},test:async()=>Se("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter(e=>e!=="avif")},be=["png","jpg","jpeg"],Ze={extension:{type:h.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...be],remove:async t=>t.filter(e=>!be.includes(e))},Qe="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function me(t){return Qe?!1:document.createElement("video").canPlayType(t)!==""}const Je={extension:{type:h.DetectionParser,priority:0},test:async()=>me("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter(e=>e!=="mp4"&&e!=="m4v")},qe={extension:{type:h.DetectionParser,priority:0},test:async()=>me("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter(e=>e!=="ogv")},et={extension:{type:h.DetectionParser,priority:0},test:async()=>me("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter(e=>e!=="webm")},tt={extension:{type:h.DetectionParser,priority:0},test:async()=>Se("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter(e=>e!=="webp")};class st{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,s,a)=>(this._parsersValidated=!1,e[s]=a,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,s){const a={promise:null,parser:null};return a.promise=(async()=>{let o=null,r=null;if(s.loadParser&&(r=this._parserHash[s.loadParser],r||k(`[Assets] specified load parser "${s.loadParser}" not found while loading ${e}`)),!r){for(let n=0;n<this.parsers.length;n++){const i=this.parsers[n];if(i.load&&i.test?.(e,s,this)){r=i;break}}if(!r)return k(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await r.load(e,s,this),a.parser=r;for(let n=0;n<this.parsers.length;n++){const i=this.parsers[n];i.parse&&i.parse&&await i.testParse?.(o,s,this)&&(o=await i.parse(o,s,this)||o,a.parser=i)}return o})(),a}async load(e,s){this._parsersValidated||this._validateParsers();let a=0;const o={},r=Te(e),n=D(e,c=>({alias:[c],src:c})),i=n.length,l=n.map(async c=>{const u=z.toAbsolute(c.src);if(!o[c.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,c)),o[c.src]=await this.promiseCache[u].promise,s&&s(++a/i)}catch(E){throw delete this.promiseCache[u],delete o[c.src],new Error(`[Loader.load] Failed to load ${u}.
${E}`)}});return await Promise.all(l),r?o[n[0].src]:o}async unload(e){const a=D(e,o=>({alias:[o],src:o})).map(async o=>{const r=z.toAbsolute(o.src),n=this.promiseCache[r];if(n){const i=await n.promise;delete this.promiseCache[r],await n.parser?.unload?.(i,o,this)}});await Promise.all(a)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,s)=>(s.name?e[s.name]&&k(`[Assets] loadParser name conflict "${s.name}"`):k("[Assets] loadParser should have a name"),{...e,[s.name]:s}),{})}}function M(t,e){if(Array.isArray(e)){for(const s of e)if(t.startsWith(`data:${s}`))return!0;return!1}return t.startsWith(`data:${e}`)}function j(t,e){const s=t.split("?")[0],a=z.extname(s).toLowerCase();return Array.isArray(e)?e.includes(a):a===e}const at=".json",ot="application/json",rt={extension:{type:h.LoadParser,priority:Z.Low},name:"loadJson",test(t){return M(t,ot)||j(t,at)},async load(t){return await(await I.get().fetch(t)).json()}},it=".txt",nt="text/plain",lt={name:"loadTxt",extension:{type:h.LoadParser,priority:Z.Low},test(t){return M(t,nt)||j(t,it)},async load(t){return await(await I.get().fetch(t)).text()}},ct=["normal","bold","100","200","300","400","500","600","700","800","900"],dt=[".ttf",".otf",".woff",".woff2"],ht=["font/ttf","font/otf","font/woff","font/woff2"],ft=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function ut(t){const e=z.extname(t),o=z.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1));let r=o.length>0;for(const i of o)if(!i.match(ft)){r=!1;break}let n=o.join(" ");return r||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const pt=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function mt(t){return pt.test(t)?t:encodeURI(t)}const At={extension:{type:h.LoadParser,priority:Z.Low},name:"loadWebFont",test(t){return M(t,ht)||j(t,dt)},async load(t,e){const s=I.get().getFontFaceSet();if(s){const a=[],o=e.data?.family??ut(t),r=e.data?.weights?.filter(i=>ct.includes(i))??["normal"],n=e.data??{};for(let i=0;i<r.length;i++){const l=r[i],c=new FontFace(o,`url(${mt(t)})`,{...n,weight:l});await c.load(),s.add(c),a.push(c)}return b.set(`${o}-and-url`,{url:t,fontFaces:a}),a.length===1?a[0]:a}return k("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>{b.remove(e.family),I.get().getFontFaceSet().delete(e)})}};function Ae(t,e=1){const s=oe.RETINA_PREFIX?.exec(t);return s?parseFloat(s[1]):e}function ge(t,e,s){t.label=s,t._sourceOrigin=s;const a=new Re({source:t,label:s}),o=()=>{delete e.promiseCache[s],b.has(s)&&b.remove(s)};return a.source.once("destroy",()=>{e.promiseCache[s]&&(k("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),o())}),a.once("destroy",()=>{t.destroyed||(k("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),o())}),a}const gt=".svg",wt="image/svg+xml",yt={extension:{type:h.LoadParser,priority:Z.Low},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(t){return M(t,wt)||j(t,gt)},async load(t,e,s){return e.data.parseAsGraphicsContext??this.config.parseAsGraphicsContext?xt(t):vt(t,e,s,this.config.crossOrigin)},unload(t){t.destroy(!0)}};async function vt(t,e,s,a){const r=await(await I.get().fetch(t)).blob(),n=URL.createObjectURL(r),i=new Image;i.src=n,i.crossOrigin=a,await i.decode(),URL.revokeObjectURL(n);const l=document.createElement("canvas"),c=l.getContext("2d"),u=e.data?.resolution||Ae(t),E=e.data?.width??i.width,U=e.data?.height??i.height;l.width=E*u,l.height=U*u,c.drawImage(i,0,0,E*u,U*u);const{parseAsGraphicsContext:xe,...Ue}=e.data,Ge=new Pe({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:u,...Ue});return ge(Ge,s,t)}async function xt(t){const s=await(await I.get().fetch(t)).text(),a=new Ve;return a.svg(s),a}const bt=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let S=null,fe=class{constructor(){S||(S=URL.createObjectURL(new Blob([bt],{type:"application/javascript"}))),this.worker=new Worker(S)}};fe.revokeObjectURL=function(){S&&(URL.revokeObjectURL(S),S=null)};const _t=`(function () {
    'use strict';

    async function loadImageBitmap(url) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      const imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap;
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let O=null;class Oe{constructor(){O||(O=URL.createObjectURL(new Blob([_t],{type:"application/javascript"}))),this.worker=new Worker(O)}}Oe.revokeObjectURL=function(){O&&(URL.revokeObjectURL(O),O=null)};let _e=0,he;class kt{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:s}=new fe;s.addEventListener("message",a=>{s.terminate(),fe.revokeObjectURL(),e(a.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){he===void 0&&(he=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<he&&(this._createdWorkers++,e=new Oe().worker,e.addEventListener("message",s=>{this._complete(s.data),this._returnWorker(s.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,s){await this._initWorkers();const a=new Promise((o,r)=>{this._queue.push({id:e,arguments:s,resolve:o,reject:r})});return this._next(),a}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const s=this._queue.pop(),a=s.id;this._resolveHash[_e]={resolve:s.resolve,reject:s.reject},e.postMessage({data:s.arguments,uuid:_e++,id:a})}}const ke=new kt,Lt=[".jpeg",".jpg",".png",".webp",".avif"],Et=["image/jpeg","image/png","image/webp","image/avif"];async function Bt(t){const e=await I.get().fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const s=await e.blob();return await createImageBitmap(s)}const We={name:"loadTextures",extension:{type:h.LoadParser,priority:Z.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return M(t,Et)||j(t,Lt)},async load(t,e,s){let a=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await ke.isImageBitmapSupported()?a=await ke.loadImageBitmap(t):a=await Bt(t):a=await new Promise(r=>{a=new Image,a.crossOrigin=this.config.crossOrigin,a.src=t,a.complete?r(a):a.onload=()=>{r(a)}});const o=new Pe({resource:a,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||Ae(t),...e.data});return ge(o,s,t)},unload(t){t.destroy(!0)}},Me=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],Ct=Me.map(t=>`video/${t.substring(1)}`);function It(t,e,s){s===void 0&&!e.startsWith("data:")?t.crossOrigin=Tt(e):s!==!1&&(t.crossOrigin=typeof s=="string"?s:"anonymous")}function Rt(t){return new Promise((e,s)=>{t.addEventListener("canplaythrough",a),t.addEventListener("error",o),t.load();function a(){r(),e()}function o(n){r(),s(n)}function r(){t.removeEventListener("canplaythrough",a),t.removeEventListener("error",o)}})}function Tt(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const s=new URL(t,document.baseURI);return s.hostname!==e.hostname||s.port!==e.port||s.protocol!==e.protocol?"anonymous":""}const Pt={name:"loadVideo",extension:{type:h.LoadParser},config:null,test(t){const e=M(t,Ct),s=j(t,Me);return e||s},async load(t,e,s){const a={...de.defaultOptions,resolution:e.data?.resolution||Ae(t),alphaMode:e.data?.alphaMode||await Ke(),...e.data},o=document.createElement("video"),r={preload:a.autoLoad!==!1?"auto":void 0,"webkit-playsinline":a.playsinline!==!1?"":void 0,playsinline:a.playsinline!==!1?"":void 0,muted:a.muted===!0?"":void 0,loop:a.loop===!0?"":void 0,autoplay:a.autoPlay!==!1?"":void 0};Object.keys(r).forEach(l=>{const c=r[l];c!==void 0&&o.setAttribute(l,c)}),a.muted===!0&&(o.muted=!0),It(o,t,a.crossorigin);const n=document.createElement("source");let i;if(t.startsWith("data:"))i=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const l=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();i=de.MIME_TYPES[l]||`video/${l}`}return n.src=t,i&&(n.type=i),new Promise(l=>{const c=async()=>{const u=new de({...a,resource:o});o.removeEventListener("canplay",c),e.data.preload&&await Rt(o),l(ge(u,s,t))};o.addEventListener("canplay",c),o.appendChild(n)})},unload(t){t.destroy(!0)}},je={extension:h.ResolveParser,test:We.test,parse:t=>({resolution:parseFloat(oe.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})},St={extension:h.ResolveParser,test:t=>oe.RETINA_PREFIX.test(t)&&t.endsWith(".json"),parse:je.parse};class Ot{constructor(){this._detections=[],this._initialized=!1,this.resolver=new oe,this.loader=new st,this.cache=b,this._backgroundLoader=new Xe(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){k("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let r=e.manifest;typeof r=="string"&&(r=await this.load(r)),this.resolver.addManifest(r)}const s=e.texturePreference?.resolution??1,a=typeof s=="number"?[s]:s,o=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:a}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,s){this._initialized||await this.init();const a=Te(e),o=D(e).map(i=>{if(typeof i!="string"){const l=this.resolver.getAlias(i);return l.some(c=>!this.resolver.hasKey(c))&&this.add(i),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(i)||this.add({alias:i,src:i}),i}),r=this.resolver.resolve(o),n=await this._mapLoadToResolve(r,s);return a?n[o[0]]:n}addBundle(e,s){this.resolver.addBundle(e,s)}async loadBundle(e,s){this._initialized||await this.init();let a=!1;typeof e=="string"&&(a=!0,e=[e]);const o=this.resolver.resolveBundle(e),r={},n=Object.keys(o);let i=0,l=0;const c=()=>{s?.(++i/l)},u=n.map(E=>{const U=o[E];return l+=Object.keys(U).length,this._mapLoadToResolve(U,c).then(xe=>{r[E]=xe})});return await Promise.all(u),a?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const s=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(s))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const s=this.resolver.resolveBundle(e);Object.values(s).forEach(a=>{this._backgroundLoader.add(Object.values(a))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return b.get(e);const s={};for(let a=0;a<e.length;a++)s[a]=b.get(e[a]);return s}async _mapLoadToResolve(e,s){const a=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const o=await this.loader.load(a,s);this._backgroundLoader.active=!0;const r={};return a.forEach(n=>{const i=o[n.src],l=[n.src];n.alias&&l.push(...n.alias),l.forEach(c=>{r[c]=i}),b.set(l,i)}),r}async unload(e){this._initialized||await this.init();const s=D(e).map(o=>typeof o!="string"?o.src:o),a=this.resolver.resolve(s);await this._unloadFromResolved(a)}async unloadBundle(e){this._initialized||await this.init(),e=D(e);const s=this.resolver.resolveBundle(e),a=Object.keys(s).map(o=>this._unloadFromResolved(s[o]));await Promise.all(a)}async _unloadFromResolved(e){const s=Object.values(e);s.forEach(a=>{b.remove(a.src)}),await this.loader.unload(s)}async _detectFormats(e){let s=[];e.preferredFormats&&(s=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const a of e.detections)e.skipDetections||await a.test()?s=await a.add(s):e.skipDetections||(s=await a.remove(s));return s=s.filter((a,o)=>s.indexOf(a)===o),s}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(s=>{s.config&&Object.keys(s.config).filter(a=>a in e).forEach(a=>{s.config[a]=e[a]})})}}const y=new Ot;V.handleByList(h.LoadParser,y.loader.parsers).handleByList(h.ResolveParser,y.resolver.parsers).handleByList(h.CacheParser,y.cache.parsers).handleByList(h.DetectionParser,y.detections);V.add(ze,Ze,Ye,tt,Je,qe,et,rt,lt,At,yt,We,Pt,je,St);const Le={loader:h.LoadParser,resolver:h.ResolveParser,cache:h.CacheParser,detection:h.DetectionParser};V.handle(h.Asset,t=>{const e=t.ref;Object.entries(Le).filter(([s])=>!!e[s]).forEach(([s,a])=>V.add(Object.assign(e[s],{extension:e[s].extension??a})))},t=>{const e=t.ref;Object.keys(Le).filter(s=>!!e[s]).forEach(s=>V.remove(e[s]))});const L=10,F=20,w=24,Wt=[53,49,45,41,37,33,28,22,17,11,10,9,8,7,6,6,5,5,4,4,3],Mt=[0,40,100,300,1200],ue=20,Ee=999999,R=8,pe={J:{type:"J",color:"blue",rotations:[[[3,-2],[3,-1],[4,-1],[5,-1]],[[4,-2],[5,-2],[4,-1],[4,0]],[[3,-1],[4,-1],[5,-1],[5,0]],[[4,-2],[4,-1],[3,0],[4,0]]],wallKickTests:[[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]]},T:{type:"T",color:"purple",rotations:[[[4,-2],[3,-1],[4,-1],[5,-1]],[[4,-2],[4,-1],[5,-1],[4,0]],[[3,-1],[4,-1],[5,-1],[4,0]],[[4,-2],[3,-1],[4,-1],[4,0]]],wallKickTests:[[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]]},L:{type:"L",color:"orange",rotations:[[[5,-2],[3,-1],[4,-1],[5,-1]],[[4,-2],[4,-1],[4,0],[5,0]],[[3,-1],[4,-1],[5,-1],[3,0]],[[3,-2],[4,-2],[4,-1],[4,0]]],wallKickTests:[[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]]},S:{type:"S",color:"green",rotations:[[[4,-2],[5,-2],[3,-1],[4,-1]],[[4,-2],[4,-1],[5,-1],[5,0]],[[4,-1],[5,-1],[3,0],[4,0]],[[3,-2],[3,-1],[4,-1],[4,0]]],wallKickTests:[[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]]},I:{type:"I",color:"cyan",rotations:[[[3,-1],[4,-1],[5,-1],[6,-1]],[[5,-2],[5,-1],[5,0],[5,1]],[[3,0],[4,0],[5,0],[6,0]],[[4,-2],[4,-1],[4,0],[4,1]]],wallKickTests:[[[0,0],[-2,0],[1,0],[1,-2],[-2,1]],[[0,0],[-2,0],[1,0],[-2,-1],[1,1]],[[0,0],[2,0],[-1,0],[2,-1],[-1,2]],[[0,0],[-1,0],[2,0],[-1,-2],[2,1]]]},O:{type:"O",color:"yellow",rotations:[[[4,-2],[5,-2],[4,-1],[5,-1]],[[4,-2],[5,-2],[4,-1],[5,-1]],[[4,-2],[5,-2],[4,-1],[5,-1]],[[4,-2],[5,-2],[4,-1],[5,-1]]],wallKickTests:[[[0,0]],[[0,0]],[[0,0]],[[0,0]]]},Z:{type:"Z",color:"red",rotations:[[[3,-2],[4,-2],[4,-1],[5,-1]],[[5,-2],[4,-1],[5,-1],[4,0]],[[3,-1],[4,-1],[4,0],[5,0]],[[4,-2],[3,-1],[4,-1],[3,0]]],wallKickTests:[[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]]}},$=w*5,jt=L*w+$,T=F*w;let f=new $e,q=new Ne;q.stage.addChild(f);let we=new He;we.rect(0,0,$,T);we.fill(12298973);f.addChild(we);let re=new Q({text:`Level
0`,fill:"black"});re.x=R;re.y=R;f.addChild(re);let ie=new Q({text:`Clear
0`,fill:"black"});ie.x=R;ie.y=Math.floor((T-56)/4);f.addChild(ie);let ye=new Q({text:"Next",fill:"black"});ye.x=R;ye.y=Math.floor((T-56)/2);f.addChild(ye);let ne=new Q({text:`Hi Score
0`,fill:"black"});ne.x=R;ne.y=Math.floor((T-56)*3/4);f.addChild(ne);let le=new Q({text:`Score
0`,fill:"black"});le.x=R;le.y=T-56-R;f.addChild(le);let se={bundles:[{name:"blocks",assets:[]},{name:"tetrominos",assets:[]}]};for(let t of Object.values(pe))se.bundles[0].assets.push({alias:t.color,src:`/Tetris/assets/blocks/${t.color}.png`}),se.bundles[1].assets.push({alias:t.type,src:`/Tetris/assets/tetrominos/${t.type}.png`});se.bundles[0].assets.push({alias:"grey",src:"/Tetris/assets/blocks/grey.png"});let d=[];for(let t=0;t<L;t++){d[t]=[];for(let e=0;e<F;e++)d[t][e]={color:null,exists:!1,sprite:null}}let g=0,m=0,N=0,W=!1,H=1,A=Y(),ee=Y(),p=0,x=[],B=[],_=0,ae=0,te=0,v=0,X=0,ce=!1,P=new K;f.addChild(P);let C=[];window.addEventListener("keydown",function(t){if(t.code==="KeyP"&&(W=!W),!W)switch(t.code){case"ArrowLeft":C.push(G(Be,this,["left"]));break;case"ArrowRight":C.push(G(Be,this,["right"]));break;case"ArrowDown":C.push(G(Vt,this,[]));break;case"Space":ce=!0;break;case"ArrowUp":case"KeyZ":C.push(G(Ce,this,["clockwise"]));break;case"KeyX":C.push(G(Ce,this,["counterClockwise"]));break}});window.addEventListener("keyup",function(t){t.code==="Space"&&(ce=!1)});function G(t,e,s){return function(){t.apply(e,s)}}function Y(){let t=Object.keys(pe),e=Math.floor(Math.random()*t.length);return JSON.parse(JSON.stringify(pe[t[e]]))}function J(t,e){let s=A.rotations[p];for(let a=0;a<s.length;a++){let o=s[a][0]+t,r=s[a][1]+e;if(o<0||o>=L||r>=F||r>=0&&d[o][r].exists)return!1}return!0}function Ft(t){for(let e=0;e<L;e++){d[e][t].sprite!==null&&f.removeChild(d[e][t].sprite);for(let s=t;s>0;s--)d[e][s]=d[e][s-1]}for(let e=0;e<L;e++)d[e][0]={color:null,exists:!1,sprite:null}}function Ut(t){for(let e=0;e<L;e++)if(!d[e][t].exists)return!1;return!0}function Gt(){for(N=m;J(g,N+1);)N++}async function Fe(){for(let t=0;t<L;t++)for(let e=0;e<F;e++)d[t][e].sprite!==null&&f.removeChild(d[t][e].sprite),d[t][e]={color:null,exists:!1,sprite:null};for(let t=0;t<x.length;t++)f.removeChild(x[t]),f.removeChild(B[t]);g=0,m=0,N=0,W=!1,H=1,A=Y(),ee=Y(),p=0,x=[],B=[],_=0,te=0,v=0,ce=!1,ae=parseInt(localStorage.getItem("tetris-startingLevel")),X=parseInt(localStorage.getItem("tetris-highscore")),await ve()}async function ve(){let t=0;for(let s=0;s<F;s++)Ut(s)&&(Ft(s),te++,t++);A=ee,ee=Y(),g=0,m=0;let e=A.rotations[p];for(let s=0;s<e.length;s++){let a=e[s][0],o=e[s][1];if(o<0&&(o=0),d[a][o].exists){await Kt();return}}_=Math.floor(te/10)+ae,v+=Mt[t]*(_+1),_=_>ue?ue:_,v=v>Ee?Ee:v,re.text=`Level
`+_,ie.text=`Clear
`+te,le.text=`Score
`+v,ne.text=`Hi Score
`+X,f.removeChild(P),P=new K({texture:y.get(ee.type)}),P.x=w/2,P.y=Math.floor(T/2+w/2),f.addChild(P),H=1}async function Dt(){if(H===0||ce)if(J(g,m+1))m++;else{let t=A.rotations[p];for(let e=0;e<t.length;e++){let s=t[e][0]+g,a=t[e][1]+m;s>=0&&a>=0&&(d[s][a].exists=!0,d[s][a].color=A.color)}await ve();return}H=(H+1)%Wt[_]}async function Vt(){for(;J(g,m+1);)m++;let t=A.rotations[p];for(let e=0;e<t.length;e++){let s=t[e][0]+g,a=t[e][1]+m;s>=0&&a>=0&&(d[s][a].exists=!0,d[s][a].color=A.color)}await ve()}function Be(t){let e=g;t==="right"&&e++,t==="left"&&e--,J(e,m)&&(g=e)}function Ce(t){let e,s=p;t==="counterClockwise"&&(p=(p-1+4)%4,e=-1),t==="clockwise"&&(p=(p+1)%4,e=1);let a=!1;for(let o=0;o<A.wallKickTests[p].length;o++){let r=g+A.wallKickTests[p][o][0]*e,n=m+A.wallKickTests[p][o][1]*e;if(J(r,n)){g=r,m=n,a=!0;break}}a||(p=s)}async function Kt(){W=!0;let t;v>=X?(X=v,localStorage.setItem("tetris-highscore",X),t={title:"Congrats!",text:"You got a new highscore of "+v+"!",icon:"success",confirmButtonText:"New Game"}):t={title:"Game Over",text:"You got a score of "+v+".",icon:"info",confirmButtonText:"New Game"},await De.fire(t),await Fe()}async function $t(){if(!W){for(;C.length>0;)C.shift()();await Dt()}for(let e=0;e<L;e++)for(let s=0;s<F;s++)d[e][s].sprite!==null&&(f.removeChild(d[e][s].sprite),d[e][s].sprite=null),d[e][s].exists&&(d[e][s].sprite=new K({texture:y.get(d[e][s].color)}),d[e][s].sprite.x=e*w+$,d[e][s].sprite.y=s*w,f.addChild(d[e][s].sprite));Gt();for(let e=0;e<x.length;e++)f.removeChild(x[e]),f.removeChild(B[e]);let t=A.rotations[p];for(let e=0;e<t.length;e++){let s=t[e][0]+g,a=t[e][1]+N;B[e]=new K({texture:y.get("grey")}),B[e].x=s*w+$,B[e].y=a*w,f.addChild(B[e]);let o=t[e][1]+m;x[e]=new K({texture:y.get(A.color)}),x[e].x=s*w+$,x[e].y=o*w,f.addChild(x[e])}}let Ie=!0;document.addEventListener("astro:page-load",async function(t){t.target.title==="Tetris"&&(localStorage.getItem("tetris-highscore")!==null?document.querySelector("#startingLevel").value=localStorage.getItem("tetris-startingLevel"):(localStorage.setItem("tetris-startingLevel",0),localStorage.setItem("tetris-highscore",0)),document.querySelector("#startingLevel").addEventListener("change",function(e){ae=Math.max(0,Math.min(ue,parseInt(document.querySelector("#startingLevel").value))),localStorage.setItem("tetris-startingLevel",ae)}),Ie&&(await q.init({width:jt,height:T}),await y.init({manifest:se}),await y.loadBundle("blocks"),await y.loadBundle("tetrominos"),q.ticker.add(e=>$t()),Ie=!1),document.querySelector("#container").insertBefore(q.canvas,document.querySelector("#container").lastChild),await Fe())});
